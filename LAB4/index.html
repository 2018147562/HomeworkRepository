<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈμ…λ‹λ‹¤.</title>
  <link rel="stylesheet" href="main.css" />
</head>
<body>
  <div class="container">
    <h1>μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈμ…λ‹λ‹¤.</h1>
    <div class="nav">
      <a class="active" href="index.html">λ©”μΈνμ΄μ§€</a>
      <a href="login.html">λ΅κ·ΈμΈ</a>
      <a href="signup.html">νμ›κ°€μ…</a>
    </div>

    <div class="search-bar">
      <input type="text" id="keyword" placeholder="ν‚¤μ›λ“λ¥Ό μ…λ ¥ν•μ„Έμ”." />
      <button onclick="filterMovies()">Filter results</button>
    </div>

    <div class="sort-section">
      <h3>μ •λ ¬ κΈ°μ¤€</h3>
      <label><input type="radio" name="sort" value="rating-desc" /> ν‰μ  λ‚΄λ¦Όμ°¨μ</label><br />
      <label><input type="radio" name="sort" value="rating-asc" /> ν‰μ  μ¤λ¦„μ°¨μ</label><br />
      <label><input type="radio" name="sort" value="release-desc" /> κ°λ΄‰ λ‚΄λ¦Όμ°¨μ</label><br />
      <label><input type="radio" name="sort" value="release-asc" /> κ°λ΄‰ μ¤λ¦„μ°¨μ</label>
    </div>

    <h2>Movies</h2>
    <div id="movie-list"></div>

    <div class="about">
      <h2>About</h2>
      <p>μ—¬κΈ°λ” μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈμ…λ‹λ‹¤!</p>
      <p>μ›ν•λ” μν™”λ¥Ό κ²€μƒ‰ν•κ±°λ‚ μμ„Έν• μ •λ³΄λ¥Ό ν™•μΈν•΄λ³΄μ„Έμ”.</p>
    </div>

    <footer>Copyright Β© 2025 INFPMOVIES</footer>
  </div>

  <script>
    let movies = [];
    let index = 0;
    const pageSize = 6;

    window.onload = async () => {
      const res = await fetch("product.json");
      movies = await res.json();
      loadMovies();
      window.addEventListener("scroll", handleScroll);
    };

    function handleScroll() {
      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 50) {
        loadMovies();
      }
    }

    function loadMovies() {
      const container = document.getElementById("movie-list");
      const end = Math.min(index + pageSize, movies.length);

      for (let i = index; i < end; i++) {
        const movie = movies[i];
        const div = document.createElement("div");
        div.className = "movie";

        div.innerHTML = `
          <div class="poster">
            <img src="images/${movie.image}" alt="${movie.title}" />
            <div class="overview">
              <p>μ¤„κ±°λ¦¬:<br>${movie.overview}</p>
            </div>
          </div>
          <div class="info">
            <h3>${movie.title}</h3>
            <p>π“… ${movie.release_date}</p>
            <p>β­ ${movie.vote_average}/10</p>
          </div>
        `;
        container.appendChild(div);
      }

      index = end;
    }

    function filterMovies() {
      const keyword = document.getElementById("keyword").value.toLowerCase();
      const sortValue = document.querySelector("input[name='sort']:checked")?.value;

      let filtered = movies.filter(m =>
        m.title.toLowerCase().includes(keyword) ||
        m.overview.toLowerCase().includes(keyword)
      );

      if (sortValue === "rating-desc") filtered.sort((a, b) => b.vote_average - a.vote_average);
      if (sortValue === "rating-asc") filtered.sort((a, b) => a.vote_average - b.vote_average);
      if (sortValue === "release-desc") filtered.sort((a, b) => new Date(b.release_date) - new Date(a.release_date));
      if (sortValue === "release-asc") filtered.sort((a, b) => new Date(a.release_date) - new Date(b.release_date));

      index = 0;
      document.getElementById("movie-list").innerHTML = "";
      for (let i = 0; i < Math.min(pageSize, filtered.length); i++) {
        const movie = filtered[i];
        const div = document.createElement("div");
        div.className = "movie";

        div.innerHTML = `
          <div class="poster">
            <img src="images/${movie.image}" alt="${movie.title}" />
            <div class="overview">
              <p>μ¤„κ±°λ¦¬:<br>${movie.overview}</p>
            </div>
          </div>
          <div class="info">
            <h3>${movie.title}</h3>
            <p>π“… ${movie.release_date}</p>
            <p>β­ ${movie.vote_average}/10</p>
          </div>
        `;
        document.getElementById("movie-list").appendChild(div);
      }
    }
  </script>
</body>
</html>
